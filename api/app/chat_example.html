<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO Chat Test</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Socket.IO User-to-User Chat</h1>
    
    <div>
        <label for="user_id">Your User ID:</label>
        <input type="text" id="user_id" placeholder="Enter your user ID">
        <button onclick="connectToServer()">Connect</button>
    </div>

    <div id="status" style="margin-top: 10px; color: green;"></div>

    <div id="chat" style="display: none; margin-top: 20px;">
        <h2>Chat</h2>
        <div>
            <label for="receiver_id">Send Message to User ID:</label>
            <input type="text" id="receiver_id" placeholder="Enter receiver's user ID">
        </div>
        
        <div style="margin-top: 10px;">
            <textarea id="message" placeholder="Type your message here" rows="3" cols="30"></textarea>
            <button onclick="sendMessage()">Send Message</button>
        </div>
        
        <h3>Messages:</h3>
        <div id="messages" style="border: 1px solid #ccc; padding: 10px; width: 300px; height: 200px; overflow-y: scroll;">
        </div>
    </div>

    <script>
        let socket;

        function connectToServer() {
            const userId = document.getElementById('user_id').value;
            if (!userId) {
                alert('Please enter your user ID.');
                return;
            }

            // Connect to the server with the user ID
            socket = io('http://localhost:5001', { query: { user_id: userId } });

            // Show the chat interface and update status
            socket.on('connect', () => {
                document.getElementById('status').innerText = `Connected as User ${userId}`;
                document.getElementById('chat').style.display = 'block';
            });

            // Listen for incoming messages
            socket.on('receive_message', (data) => {
                const messagesDiv = document.getElementById('messages');
                const newMessage = document.createElement('div');
                newMessage.textContent = `User ${data.sender_id}: ${data.content} (at ${data.timestamp})`;
                messagesDiv.appendChild(newMessage);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            });

            // Listen for status updates (e.g., when users connect or disconnect)
            socket.on('status', (data) => {
                const statusDiv = document.createElement('div');
                statusDiv.textContent = data.msg;
                document.getElementById('messages').appendChild(statusDiv);
            });
        }

        function sendMessage() {
            const receiverId = document.getElementById('receiver_id').value;
            const message = document.getElementById('message').value;

            if (!receiverId || !message) {
                alert('Please enter a receiver ID and a message.');
                return;
            }

            // Send the message to the server
            socket.emit('send_message', {
                sender_id: document.getElementById('user_id').value,
                receiver_id: receiverId,
                content: message
            });

            // Show the sent message in the chat interface
            const messagesDiv = document.getElementById('messages');
            const newMessage = document.createElement('div');
            newMessage.style.color = 'blue';
            newMessage.textContent = `You to User ${receiverId}: ${message}`;
            messagesDiv.appendChild(newMessage);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Clear the message input
            document.getElementById('message').value = '';
        }
    </script>
</body>
</html>
